<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
        <!-- <link rel="stylesheet" href="style.css"> -->
        <title>SIGNALS</title>
    </head>
    <body>
        <style>
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                -webkit-tap-highlight-color: rgba(72, 72, 250, 0.1);
            }

            body {
                overflow-x: hidden;
                overflow-y: hidden;
            }

            .main {
                overflow-x: hidden;
                overflow-y: hidden;
                max-width: 100vw;
                min-height: 100vh;
                display: flex;
                justify-content: center;
            }

            .gradient-bg {
                /* background: url("static/mimines_bg.jpg"); */
                background-size: cover;
                background-position: 20%;
                background-repeat: no-repeat;
                /* filter: brightness(105%); */
                background: linear-gradient(#171318, #171318);
            }

            .container {
                padding: 10vh 0;
                width: 90%;
                display: flex;
                justify-content: space-between;
                flex-direction: column;
            }


            /* ШАПКА */

            .top-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 3vmax;
                margin-bottom: 5vh;
            }

            .title {
                grid-area: title;
                font-family: sans-serif;
                font-size: 5vmax;
                font-weight: bold;
                text-align: center;
                color: white;
                text-shadow: 0 0 20px rgba(0, 0, 0, 1);
                /* margin-bottom: 1.5vh; */
            }

            .mines-count-select {
                grid-area: traps;
                text-align: center;
                font-size: 2.5vmax;
                height: 6vh;
                width: 97%;
                border-radius: 1vmax;
                outline: 1px solid #052577;
                border: none;
                color: white;
                background-color: #0835ab;
                font-weight: bold;
            }

            /* СИГНАЛЫ */
            .signals-container {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: repeat(5, 1fr);
                column-gap: 0.8vmax;
                row-gap: 0.8vmax;

                justify-items: stretch;
                justify-content: center;
                align-items: center;

                /* margin-bottom: 10vh; */
            }

            .cell {
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                aspect-ratio: 2.5 / 2;
                border-radius: 0.5vmax;
            }

            .cell::before {
                content: "";
                position: absolute;
                width: 35%;
                aspect-ratio: 1;
                border-radius: 50%;
            }


            .cell-disabled {
                background-color: #2a2a32;
                border: 0.3vmax solid #313131;
                /* box-shadow: 0 0.6vmax #062b6e; */
            }

            .cell-disabled::before {
                background-image: url("static/1w.png");
                background-position: center;
                background-repeat: no-repeat;
                background-size: 90%;
                width: 80%;
            }

            .cell-active {
                background: radial-gradient(circle at 50% 120%, #2a60b1, #161927);
                /* border: 0.4vmax solid #2a60b1; */
                transform: scale(0);
                animation: pop-up 0.5s ease-out forwards;
            }

            .cell-active::before {
                background-image: url("static/star.png");
                background-position: center;
                background-repeat: no-repeat;
                background-size: 90%;
                width: 55%;
                transform: scale(0);
                animation: star-pop 0.6s ease-out 0.2s forwards;
            }

            @keyframes pop-up {
                0% {
                    transform: scale(0);
                    opacity: 0;
                }
                70% {
                    transform: scale(1.1);
                    opacity: 1;
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }

            @keyframes star-pop {
                0% {
                    transform: scale(0);
                }
                50% {
                    transform: scale(1.2);
                }
                100% {
                    transform: scale(1);
                }
            }
            .roll-cell {
                animation: roll ease-out 0.8s;
                animation-iteration-count: 1;
            }


            /* КНОПКИ УПРАВЛЕНИЯ */
            .controls {
                display: grid;
                grid-template-areas: 
                    "title title"
                    "traps traps"
                    "restart get-signal";
                justify-content: space-evenly;
                justify-items: center;
                row-gap: 4vh;
                width: 100%;
            }

            .restart-button {
                grid-area: restart;
                background-color: #0835ab;
                border: none;
                height: 10vh;
                padding: 1%;
                aspect-ratio: 1/1;
                border-radius: 1vmax;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .restart-button {
                grid-area: restart;
                background-color: #0835ab;
                border: none;
                height: 10vh;
                padding: 1%;
                aspect-ratio: 1/1;
                border-radius: 1vmax;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .restart-button img {
                width: 70%;
                aspect-ratio: 1;
            }

            .spin-on-click {
                animation: spin-around ease-out 0.3s;
                animation-iteration-count: 1;
            }

            @keyframes spin-around {
                from {
                    transform: rotate(0deg);
                }
                to {
                    transform: rotate(360deg);
                }
            }

            .get-signal {
                grid-area: get-signal;
                height: 10vh;
                padding: 0 8vw;
                font-size: large;
                font-weight: bold;
                border-radius: 1vmax;
                border: none;
                color: white;
                background: #36784c86;
                border: 2px solid #36784c;
            }

            @keyframes turn-small {
                from {
                    transform: scale(0.9);
                }
                to {
                    transform: scale(1);
                }
            }
            .small-on-click {
                animation: turn-small ease-in 0.2s;
                animation-iteration-count: 1;
            }
            
            @keyframes pulseAnim {
                0%, 100% {
                    transform: translateX(50%) translateY(-50%) rotate(45deg) scale(1);
                }
                50% {
                    transform: translateX(50%) translateY(-50%) rotate(45deg) scale(1.25);
                }
            }
        </style>

        <main class="main gradient-bg" id="gradient-bg">
            <div class="container">  
                <section class="signals-container">
                    <div class="cell cell-disabled"><div class="cell_"></div></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                    <div class="cell cell-disabled"></div>
                </section>

                <!-- <section class="top-content"> -->
                <!-- </section> -->
    
                <section class="controls">
                    <h1 class="title">1WIN MINES</h1>

                    <select id="difficultySelect" class="mines-count-select">
                        <option value="1">2 traps</option>
                        <option value="2">3 traps</option>
                        <option value="3">5 traps</option>
                        <option value="4">7 traps</option>
                    </select>

                    <button id="restart" class="restart-button">
                        <img src="static/reboot_arrow.png" class="restart-img"/>
                    </button>
                    <button id="getSignal" class="get-signal">
                        GET SIGNAL
                    </button>
                </section>
            </div>


        </main>
        <script>
        const getSignalButton = document.getElementById("getSignal");
        const restartButton = document.getElementById("restart");
        const cells = Array.from(document.getElementsByClassName("cell"));
        const select = document.getElementById("difficultySelect");

        // вспомогательные функции
        function generateNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function playAnim(element, animatedClass) { 
            element.classList.add(animatedClass);
            element.addEventListener('animationend', () => {
                element.classList.remove(animatedClass);
            }, {once: true});
        }

        function clearCells() {
            cells.forEach(cell => {
                cell.classList.remove("cell-active");
                cell.classList.add("cell-disabled");
            });
        }

        // конфигурации уровней сложности
        const modeToConfigMap = {
            "1": { traps: 2, stars: [6, 9] },
            "2": { traps: 3, stars: [5, 7] },
            "3": { traps: 5, stars: [4, 5] },
            "4": { traps: 7, stars: [2, 4] },
        };

        function getStarsCount() {
            const mode = select.value;
            const bounds = modeToConfigMap[mode].stars;
            return generateNumber(bounds[0], bounds[1]);
        }

        // обработка кликов
        getSignalButton.onclick = function() {
            getSignalButton.disabled = true;
            playAnim(getSignalButton, "small-on-click");
            clearCells();

            const starsCount = getStarsCount();
            const signalIndexes = [];

            while (signalIndexes.length < starsCount) {
                const cellIndex = generateNumber(0, cells.length - 1);
                if (!signalIndexes.includes(cellIndex)) signalIndexes.push(cellIndex);
            }

            signalIndexes.forEach(index => {
                const cell = cells[index];
                cell.classList.remove("cell-disabled");
                cell.classList.add("cell-active");
            });

            setTimeout(() => {
                getSignalButton.disabled = false;
            }, 500);
        };

        restartButton.onclick = function() {
            const restartImg = restartButton.querySelector('.restart-img');
            playAnim(restartImg, "spin-on-click");
            clearCells();
        };
        </script>
    </body>
</html>